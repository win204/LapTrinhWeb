<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quáº£n LÃ½ Sinh ViÃªn</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-4">

<h3 class="mb-3">ğŸ“š QUáº¢N LÃ SINH VIÃŠN</h3>

<!-- SEARCH -->
<input type="text" id="search" class="form-control mb-3"
placeholder="ğŸ” TÃ¬m theo tÃªn..." onkeyup="searchStudent()">

<!-- TABLE -->
<table class="table table-bordered table-hover">
<thead class="table-dark">
<tr>
<th>ID</th>
<th>TÃªn</th>
<th>Email</th>
<th>HÃ nh Ä‘á»™ng</th>
</tr>
</thead>
<tbody id="studentTable"></tbody>
</table>

<hr>

<!-- FORM -->
<h4 id="formTitle">â• ThÃªm sinh viÃªn</h4>

<div class="row mb-2">
<div class="col-2">
<input id="id" class="form-control" placeholder="ID" disabled>
</div>
<div class="col">
<input id="name" class="form-control" placeholder="TÃªn sinh viÃªn">
</div>
<div class="col">
<input id="email" class="form-control" placeholder="Email sinh viÃªn">
</div>
</div>

<button class="btn btn-primary" onclick="saveStudent()">ğŸ’¾ LÆ°u</button>
<button class="btn btn-secondary" onclick="resetForm()">â™» Há»§y</button>

<script>
const API = "http://localhost:8080/api/students";
let editingId = null;

// LOAD ALL
function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td>
                        <button class="btn btn-warning btn-sm"
                            onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">
                            âœ Sá»­a
                        </button>
                        <button class="btn btn-danger btn-sm"
                            onclick="deleteStudent(${s.id})">
                            ğŸ—‘ XÃ³a
                        </button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

// SAVE (ADD / UPDATE)
function saveStudent() {
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;

    if (!name || !email) {
        alert("Vui lÃ²ng nháº­p tÃªn vÃ  email!");
        return;
    }

    const student = { name, email };

    let url = API;
    let method = "POST";

    if (editingId !== null) {
        url = `${API}/${editingId}`;
        method = "PUT";
    }

    fetch(url, {
        method: method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student)
    }).then(() => {
        resetForm();
        loadStudents();
    });
}

// DELETE
function deleteStudent(id) {
    if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a sinh viÃªn nÃ y?")) return;

    fetch(`${API}/${id}`, {
        method: "DELETE"
    }).then(() => loadStudents());
}

// SEARCH
function searchStudent() {
    const name = document.getElementById("search").value.trim();

    if (name === "") {
        loadStudents();
        return;
    }

    fetch(`${API}/search?name=${name}`)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td></td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

// EDIT
function editStudent(id, name, email) {
    editingId = id;
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
    document.getElementById("formTitle").innerText = "âœ Cáº­p nháº­t sinh viÃªn";
}

// RESET
function resetForm() {
    editingId = null;
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("formTitle").innerText = "â• ThÃªm sinh viÃªn";
}

// INIT
loadStudents();
</script>

</body>
</html>
